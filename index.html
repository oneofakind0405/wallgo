<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wall Go - Î≤ΩÎ∞îÎëë</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            max-width: 800px;
            width: 100%;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            font-size: 2.5em;
            color: #333;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .player-setup {
            text-align: center;
            margin: 20px 0;
        }

        .player-count-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .player-count-btn {
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            border: 3px solid #ddd;
            background: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .player-count-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .player-count-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .current-player {
            font-size: 1.2em;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            transition: background 0.3s ease;
        }
        .current-player.red { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .current-player.yellow { background: linear-gradient(45deg, #f1c40f, #f39c12); }
        .current-player.blue { background: linear-gradient(45deg, #3498db, #2980b9); }


        .timer {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            padding: 10px 20px;
            background: #f0f0f0;
            border-radius: 25px;
            border: 3px solid #ddd;
        }

        .timer.warning {
            background: #ffeb3b;
            border-color: #ff9800;
            animation: pulse 1s infinite;
        }

        .timer.danger {
            background: #f44336;
            color: white;
            border-color: #d32f2f;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .walls-remaining {
            font-size: 1.1em;
            padding: 8px 16px;
            background: #e3f2fd;
            border-radius: 20px;
            border: 2px solid #2196f3;
        }

        .wall-break-container {
            text-align: center;
            margin: 10px 0;
        }

        .wall-break-btn {
            padding: 12px 24px;
            font-size: 1.1em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .wall-break-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .wall-break-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(7, 1fr); /* BOARD_SIZEÎ°ú Î≥ÄÍ≤Ω Í∞ÄÎä• */
            gap: 4px;
            background: #2c3e50;
            padding: 10px;
            border-radius: 15px;
            margin: 20px auto;
            max-width: 500px;
            aspect-ratio: 1;
        }

        .cell {
            background: #ecf0f1;
            border-radius: 8px;
            position: relative;
            aspect-ratio: 1;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .cell:hover {
            background: #d5dbdb;
            transform: scale(1.02);
        }

        .cell.selected {
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
        .cell.highlight-possible-move { /* Ïù¥Îèô Í∞ÄÎä•Ìïú Ïπ∏ ÌïòÏù¥ÎùºÏù¥Ìä∏ */
            background-color: #a5d6a7; /* Ïó∞ÎÖπÏÉâ */
        }

        .piece {
            width: 70%;
            height: 70%;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border: 3px solid rgba(255,255,255,0.3);
        }

        .piece:active {
            cursor: grabbing;
        }

        .piece.blinking {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .piece.red {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .piece.yellow {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
        }

        .piece.blue {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .wall {
            position: absolute;
            background: linear-gradient(45deg, #34495e, #2c3e50);
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 10; /* ÎßêÏù¥ Î≤Ω ÏúÑÏóê Î≥¥Ïù¥ÎèÑÎ°ù */
        }

        .wall.top, .wall.bottom {
            width: 100%;
            height: 6px;
            left: 0;
        }

        .wall.top { top: -3px; }
        .wall.bottom { bottom: -3px; }

        .wall.left, .wall.right {
            width: 6px;
            height: 100%;
            top: 0;
        }

        .wall.left { left: -3px; }
        .wall.right { right: -3px; }

        .wall.red { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .wall.yellow { background: linear-gradient(45deg, #f1c40f, #f39c12); }
        .wall.blue { background: linear-gradient(45deg, #3498db, #2980b9); }

        .phase-indicator {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            font-size: 1em;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #11998e, #38ef7d);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .game-over-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            margin: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .scores {
            margin: 20px 0;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            background: #f8f9fa;
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 15px;
            }
            
            .game-title {
                font-size: 2em;
            }
            
            .game-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .game-board {
                gap: 2px;
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">üß± Wall Go</h1>
        </div>

        <div id="playerSetup" class="player-setup">
            <h2>ÌîåÎ†àÏù¥Ïñ¥ ÏàòÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h2>
            <div class="player-count-selector">
                <button class="player-count-btn" onclick="selectPlayerCount(2, event)">2Î™Ö</button>
                <button class="player-count-btn" onclick="selectPlayerCount(3, event)">3Î™Ö</button>
            </div>
            <button class="btn btn-primary" onclick="startGame()" style="margin-top: 20px;">Í≤åÏûÑ ÏãúÏûë</button>
        </div>

        <div id="gameArea" style="display: none;">
            <div class="phase-indicator" id="phaseIndicator">
                Phase 1: Ï≤´ Î≤àÏß∏ Îßê Î∞∞Ïπò
            </div>

            <div class="game-info">
                <div class="current-player" id="currentPlayer">Player 1</div>
                <div class="timer" id="timer">90</div>
                <div class="walls-remaining" id="wallsRemaining">Î≤Ω 25Í∞ú ÎÇ®Ïùå</div>
            </div>

            <div class="wall-break-container">
                <button class="wall-break-btn" id="wallBreakBtn" onclick="toggleWallBreakMode()">
                    üî® Î≤Ω Î∂ÄÏàòÍ∏∞ (1Ìöå)
                </button>
            </div>

            <div class="game-board" id="gameBoard"></div>

            <div class="controls">
                <button class="btn btn-secondary" onclick="resetGame()">ÏÉà Í≤åÏûÑ</button>
                <button class="btn btn-primary" onclick="showRules()">Í≤åÏûÑ Í∑úÏπô</button>
            </div>
        </div>
    </div>

    <div id="gameOverModal" class="game-over" style="display: none;">
        <div class="game-over-content">
            <h2>üéâ Í≤åÏûÑ Ï¢ÖÎ£å!</h2>
            <div class="scores" id="finalScores">
                </div>
            <button class="btn btn-primary" onclick="resetGame()">ÏÉà Í≤åÏûÑ</button>
        </div>
    </div>

    <script>
    (function() { // IIFE ÏãúÏûë
        // Í≤åÏûÑ ÏÉÅÏàò
        const BOARD_SIZE = 7;
        const INITIAL_TIME_LEFT = 90;
        const INITIAL_WALLS_PER_PLAYER = 25; // 2Ïù∏ Í∏∞Ï§Ä, 3Ïù∏ÏùÄ Îã§Î•º Ïàò ÏûàÏùå (Í∑úÏπôÏóê Îî∞Îùº Ï°∞Ï†ï)
        const PLAYER_COLORS = ['red', 'yellow', 'blue'];
        const PLAYER_NAMES = ['Îπ®Í∞ï', 'ÎÖ∏Îûë', 'ÌååÎûë'];

        // Í≤åÏûÑ ÏÉÅÌÉú Ï†ÑÏó≠ Î≥ÄÏàò
        let gameState = {
            playerCount: 2,
            currentPlayer: 0,
            phase: 1, // 1: Ï≤´ Îßê Î∞∞Ïπò, 2: Îëê Î≤àÏß∏ Îßê Î∞∞Ïπò, 3: Í≤åÏûÑ ÌîåÎ†àÏù¥
            board: [],
            walls: [], // walls[row][col] = { top: playerIndex | null, bottom: ..., left: ..., right: ... }
            players: [], // { color, name, pieces: [{row, col}, {row, col}], wallsRemaining, wallBreakUsed }
            selectedPiece: null, // {row, col, pieceIndex}
            pieceMoved: false, // ÌòÑÏû¨ ÌÑ¥Ïóê ÎßêÏùÑ Ïù¥ÎèôÌñàÎäîÏßÄ Ïó¨Î∂Ä
            timeLeft: INITIAL_TIME_LEFT,
            timer: null,
            wallBreakMode: false,
            gameStarted: false,
            placementOrder: [], // Phase 1 Î∞∞Ïπò ÏàúÏÑú Í∏∞Î°ù
            reversePlacementIndex: 0 // Phase 2 Î∞∞Ïπò ÏàúÏÑú Ïù∏Îç±Ïä§
        };

        // ÌîåÎ†àÏù¥Ïñ¥ Ïàò ÏÑ†ÌÉù
        window.selectPlayerCount = function(count, event) {
            console.log('ÌîåÎ†àÏù¥Ïñ¥ Ïàò ÏÑ†ÌÉù:', count);
            gameState.playerCount = count;
            
            document.querySelectorAll('.player-count-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            if (event && event.target) {
                event.target.classList.add('selected');
            } else { // DOMContentLoadedÏóêÏÑú Ìò∏Ï∂ú Ïãú eventÍ∞Ä ÏóÜÏùÑ Ïàò ÏûàÏùå
                const buttons = document.querySelectorAll('.player-count-btn');
                if (count === 2 && buttons[0]) buttons[0].classList.add('selected');
                else if (count === 3 && buttons[1]) buttons[1].classList.add('selected');
            }
        }

        // Í≤åÏûÑ ÏãúÏûë
        window.startGame = function() {
            console.log('Í≤åÏûÑ ÏãúÏûë Ìï®Ïàò Ìò∏Ï∂úÎê®');
            
            const selectedBtn = document.querySelector('.player-count-btn.selected');
            if (!selectedBtn) {
                alert('ÌîåÎ†àÏù¥Ïñ¥ ÏàòÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }

            console.log('ÌôîÎ©¥ Ï†ÑÌôò Ï§ë...');
            document.getElementById('playerSetup').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('gameOverModal').style.display = 'none';
            
            console.log('Í≤åÏûÑ Ï¥àÍ∏∞Ìôî Ï§ë...');
            initializeGame();
        }

        // Í≤åÏûÑ Ï¥àÍ∏∞Ìôî
        function initializeGame() {
            console.log('Í≤åÏûÑ Ï¥àÍ∏∞Ìôî ÏãúÏûë');
            gameState.gameStarted = true;
            gameState.phase = 1;
            gameState.currentPlayer = 0;
            gameState.board = Array(BOARD_SIZE).fill(null).map(() => Array(BOARD_SIZE).fill(null));
            gameState.walls = Array(BOARD_SIZE).fill(null).map(() => Array(BOARD_SIZE).fill(null).map(() => ({
                top: null, bottom: null, left: null, right: null
            })));
            gameState.selectedPiece = null;
            gameState.pieceMoved = false;
            gameState.wallBreakMode = false;
            gameState.placementOrder = [];
            gameState.reversePlacementIndex = 0;

            // ÌîåÎ†àÏù¥Ïñ¥ Ï¥àÍ∏∞Ìôî
            gameState.players = [];
            for (let i = 0; i < gameState.playerCount; i++) {
                gameState.players.push({
                    color: PLAYER_COLORS[i],
                    name: PLAYER_NAMES[i],
                    pieces: [{row: -1, col: -1}, {row: -1, col: -1}], // ÏïÑÏßÅ Î∞∞ÏπòÎêòÏßÄ ÏïäÏùå
                    wallsRemaining: INITIAL_WALLS_PER_PLAYER, // ÌîåÎ†àÏù¥Ïñ¥ ÏàòÏóê Îî∞Îùº Î≤Ω Í∞úÏàò Ï°∞Ï†ï ÌïÑÏöî Ïãú Ïó¨Í∏∞Ïóê Î°úÏßÅ Ï∂îÍ∞Ä
                    wallBreakUsed: false
                });
            }

            createBoard();
            updateUI();
            startTimer();
            console.log('Í≤åÏûÑ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å. ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥:', gameState.players[gameState.currentPlayer].name);
        }

        // Î≥¥Îìú ÏÉùÏÑ±
        function createBoard() {
            const boardElement = document.getElementById('gameBoard');
            boardElement.innerHTML = '';
            boardElement.style.gridTemplateColumns = `repeat(${BOARD_SIZE}, 1fr)`;

            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    cell.addEventListener('click', function() {
                        handleCellClick(parseInt(this.dataset.row), parseInt(this.dataset.col), this);
                    });
                    
                    addWallPlacementEvents(cell); // Î≤Ω Î∞∞Ïπò Ïù¥Î≤§Ìä∏ (ÌÑ∞ÏπòÏö©)
                    boardElement.appendChild(cell);
                }
            }
        }
        
        // ÏÖÄ ÌÅ¥Î¶≠ Ï≤òÎ¶¨
        function handleCellClick(row, col, cellElement) {
            console.log('ÏÖÄ ÌÅ¥Î¶≠:', row, col, 'ÌòÑÏû¨ Îã®Í≥Ñ:', gameState.phase, 'Îßê Ïù¥Îèô Ïó¨Î∂Ä:', gameState.pieceMoved);

            if (gameState.wallBreakMode) {
                handleWallBreak(row, col); // Î≤Ω Î∂ÄÏàòÍ∏∞ ÏãúÎèÑ
                return;
            }

            if (gameState.phase <= 2) { // Îßê Î∞∞Ïπò Îã®Í≥Ñ
                placePieceDuringSetup(row, col);
            } else { // Í≤åÏûÑ ÌîåÎ†àÏù¥ Îã®Í≥Ñ
                if (gameState.selectedPiece) { // Ïù¥ÎØ∏ ÏÑ†ÌÉùÎêú ÎßêÏù¥ ÏûàÏùÑ Îïå
                    if (gameState.selectedPiece.row === row && gameState.selectedPiece.col === col) {
                        // ÏÑ†ÌÉùÎêú ÎßêÏùÑ Îã§Ïãú ÌÅ¥Î¶≠ (Î≤Ω Î∞∞Ïπò ÏãúÎèÑ ÎòêÎäî ÏÑ†ÌÉù Ï∑®ÏÜå)
                        if (gameState.pieceMoved) {
                             alert('Î≤ΩÏùÑ Î∞∞ÏπòÌïòÎ†§Î©¥ Ïù¥ÎèôÌïú ÎßêÏùÑ ÌÑ∞Ïπò ÌõÑ Ïä§ÏôÄÏù¥ÌîÑÌïòÍ±∞ÎÇò, Î≤Ω Î∞∞Ïπò Î≤ÑÌäºÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî. (ÌòÑÏû¨ ÌÅ¥Î¶≠ÏúºÎ°úÎäî Î∞©Ìñ• ÏßÄÏ†ï Î∂àÍ∞Ä)');
                             // Ìñ•ÌõÑ Í∞úÏÑ†: ÌÅ¥Î¶≠ÏúºÎ°ú Î≤Ω Î∞©Ìñ• ÏÑ†ÌÉù UI Ï†úÍ≥µ ÎòêÎäî Í∏∞Î≥∏ Î∞©Ìñ•ÏúºÎ°ú Î∞∞Ïπò
                        } else {
                            // ÏÑ†ÌÉù Ï∑®ÏÜå (ÎòêÎäî Îã§Î•∏ Ïï°ÏÖò)
                            gameState.selectedPiece = null;
                            cellElement.classList.remove('selected');
                            removePossibleMoveHighlights();
                        }
                    } else {
                        movePiece(row, col); // Îã§Î•∏ Ïπ∏ ÌÅ¥Î¶≠ Ïãú Ïù¥Îèô ÏãúÎèÑ
                    }
                } else { // ÏÑ†ÌÉùÎêú ÎßêÏù¥ ÏóÜÏùÑ Îïå
                    selectPiece(row, col, cellElement); // Îßê ÏÑ†ÌÉù ÏãúÎèÑ
                }
            }
        }

        // Îßê Î∞∞Ïπò (Phase 1 & 2)
        function placePieceDuringSetup(row, col) {
            if (gameState.board[row][col] !== null) {
                alert('Ïù¥ÎØ∏ ÎßêÏù¥ ÏûàÎäî ÏúÑÏπòÏûÖÎãàÎã§!');
                return;
            }

            const currentPlayerObj = gameState.players[gameState.currentPlayer];
            const pieceIndex = gameState.phase === 1 ? 0 : 1; // Ï≤´ Î≤àÏß∏ Îßê ÎòêÎäî Îëê Î≤àÏß∏ Îßê

            // Ïù¥ÎØ∏ Ìï¥Îãπ ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÎßêÏùÑ Í∑∏ ÏúÑÏπòÏóê Î∞∞ÏπòÌñàÎäîÏßÄ ÌôïÏù∏ (Ï§ëÎ≥µ Î∞∞Ïπò Î∞©ÏßÄ)
            if (currentPlayerObj.pieces[pieceIndex].row !== -1) {
                 // Ïù¥ÎØ∏ Ïù¥ Îã®Í≥ÑÏóêÏÑú ÎßêÏùÑ ÎÜìÏïòÎã§Î©¥, Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥ ÌÑ¥ÏûÑÏóêÎèÑ Î∂àÍµ¨ÌïòÍ≥† ÌÅ¥Î¶≠ÎêòÎäî Í≤ΩÏö∞ Î∞©ÏßÄ
                if ( (gameState.phase === 1 && gameState.placementOrder.includes(gameState.currentPlayer) ) ||
                     (gameState.phase === 2 && gameState.players[gameState.placementOrder[gameState.reversePlacementIndex]].pieces[1].row !== -1 ) ) {
                    // console.log("Ïù¥ÎØ∏ ÎßêÏùÑ Î∞∞ÏπòÌñàÏäµÎãàÎã§. Îã§Ïùå ÌîåÎ†àÏù¥Ïñ¥ Ï∞®Î°ÄÏûÖÎãàÎã§.");
                    // return; // Ïù¥ Î∂ÄÎ∂ÑÏùÄ Ïù¥ÎØ∏ ÌÑ¥Ïù¥ ÎÑòÏñ¥Í∞îÏùÑ Í≤ÉÏù¥ÎØÄÎ°ú ÏÇ¨Ïã§ÏÉÅ Î∂àÌïÑÏöîÌï† Ïàò ÏûàÏùå
                }
            }


            gameState.board[row][col] = { player: gameState.currentPlayer, pieceIndex: pieceIndex };
            currentPlayerObj.pieces[pieceIndex] = {row, col};
            console.log(`${currentPlayerObj.name} ÌîåÎ†àÏù¥Ïñ¥, ${pieceIndex + 1}Î≤àÏß∏ Îßê (${row}, ${col})Ïóê Î∞∞Ïπò`);

            if (gameState.phase === 1) {
                gameState.placementOrder.push(gameState.currentPlayer);
                gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.playerCount;
                
                if (gameState.placementOrder.length === gameState.playerCount) { // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Ï≤´ Î≤àÏß∏ ÎßêÏùÑ Î∞∞Ïπò ÏôÑÎ£å
                    gameState.phase = 2;
                    gameState.reversePlacementIndex = gameState.playerCount - 1; // ÎßàÏßÄÎßâ ÌîåÎ†àÏù¥Ïñ¥Î∂ÄÌÑ∞ ÏãúÏûë
                    gameState.currentPlayer = gameState.placementOrder[gameState.reversePlacementIndex];
                    console.log("Phase 2 ÏãúÏûë. ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥:", gameState.players[gameState.currentPlayer].name);
                }
            } else if (gameState.phase === 2) {
                gameState.reversePlacementIndex--;
                
                if (gameState.reversePlacementIndex >= 0) {
                    gameState.currentPlayer = gameState.placementOrder[gameState.reversePlacementIndex];
                    console.log("Phase 2 ÏßÑÌñâ. ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥:", gameState.players[gameState.currentPlayer].name);
                } else { // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Îëê Î≤àÏß∏ ÎßêÏùÑ Î∞∞Ïπò ÏôÑÎ£å
                    gameState.phase = 3;
                    gameState.currentPlayer = 0; // Ï≤´ Î≤àÏß∏ ÌîåÎ†àÏù¥Ïñ¥Î∂ÄÌÑ∞ Í≤åÏûÑ ÏãúÏûë
                    console.log("Phase 3 ÏãúÏûë. ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥:", gameState.players[gameState.currentPlayer].name);
                }
            }

            updateBoard();
            updateUI();
            resetTimer();
        }

        function highlightPossibleMoves(fromRow, fromCol) {
            removePossibleMoveHighlights();
            const directions = [[0,1], [0,-1], [1,0], [-1,0], [0,2], [0,-2], [2,0], [-2,0]]; // 1Ïπ∏, 2Ïπ∏ Ïù¥Îèô

            for (const [dr, dc] of directions) {
                const toRow = fromRow + dr;
                const toCol = fromCol + dc;

                if (toRow >= 0 && toRow < BOARD_SIZE && toCol >= 0 && toCol < BOARD_SIZE) {
                    if (isValidMove(fromRow, fromCol, toRow, toCol)) {
                        const cell = document.querySelector(`.cell[data-row="${toRow}"][data-col="${toCol}"]`);
                        if (cell) {
                            cell.classList.add('highlight-possible-move');
                        }
                    }
                }
            }
        }

        function removePossibleMoveHighlights() {
            document.querySelectorAll('.cell.highlight-possible-move').forEach(cell => {
                cell.classList.remove('highlight-possible-move');
            });
        }


        // Îßê ÏÑ†ÌÉù
        function selectPiece(row, col, cellElement) {
            const pieceData = gameState.board[row][col];
            if (!pieceData || pieceData.player !== gameState.currentPlayer) {
                console.log("ÏÑ†ÌÉù Î∂àÍ∞Ä: ÏûêÏã†Ïùò ÎßêÏù¥ ÏïÑÎãàÍ±∞ÎÇò Îπà Ïπ∏ÏûÖÎãàÎã§.");
                return;
            }
            if (gameState.pieceMoved) {
                alert("Ïù¥ÎØ∏ ÎßêÏùÑ ÏõÄÏßÅÏòÄÏäµÎãàÎã§. Î≤ΩÏùÑ Î∞∞ÏπòÌïòÍ±∞ÎÇò ÌÑ¥ÏùÑ ÎÑòÍ∏∞ÏÑ∏Ïöî.");
                return;
            }

            // Í∏∞Ï°¥ ÏÑ†ÌÉùÎêú ÏÖÄ Ïä§ÌÉÄÏùº Ï†úÍ±∞
            document.querySelectorAll('.cell.selected').forEach(cell => cell.classList.remove('selected'));

            gameState.selectedPiece = {row, col, pieceIndex: pieceData.pieceIndex};
            cellElement.classList.add('selected');
            console.log(`${gameState.players[pieceData.player].name}Ïùò Îßê (${row},${col}) ÏÑ†ÌÉùÎê®`);
            highlightPossibleMoves(row, col);
        }

        // Îßê Ïù¥Îèô
        function movePiece(toRow, toCol) {
            if (!gameState.selectedPiece) return;
            if (gameState.pieceMoved) {
                alert("Ìïú ÌÑ¥Ïóê Ìïú Î≤àÎßå Ïù¥ÎèôÌï† Ïàò ÏûàÏäµÎãàÎã§.");
                return;
            }

            const {row: fromRow, col: fromCol, pieceIndex} = gameState.selectedPiece;
            
            if (!isValidMove(fromRow, fromCol, toRow, toCol)) {
                alert('Ïù¥ÎèôÌï† Ïàò ÏóÜÎäî ÏúÑÏπòÏûÖÎãàÎã§! (Îã§Î•∏ ÎßêÏù¥ ÏûàÍ±∞ÎÇò Î≤ΩÏúºÎ°ú ÎßâÌòÄÏûàÏäµÎãàÎã§)');
                return;
            }

            // Í∏∞Ï°¥ ÏúÑÏπòÏùò Îßê Ï†ïÎ≥¥ ÏÇ≠Ï†ú
            gameState.board[fromRow][fromCol] = null;
            // ÏÉà ÏúÑÏπòÏóê Îßê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            gameState.board[toRow][toCol] = { player: gameState.currentPlayer, pieceIndex: pieceIndex };
            // ÌîåÎ†àÏù¥Ïñ¥ Í∞ùÏ≤¥Ïóê Îßê ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏
            gameState.players[gameState.currentPlayer].pieces[pieceIndex] = {row: toRow, col: toCol};
            
            console.log(`${gameState.players[gameState.currentPlayer].name} Îßê (${fromRow},${fromCol}) -> (${toRow},${toCol}) Ïù¥Îèô`);
            
            gameState.selectedPiece = {row: toRow, col: toCol, pieceIndex: pieceIndex}; // ÏÑ†ÌÉùÎêú Îßê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ (Ïù¥ÎèôÌïú ÏúÑÏπòÎ°ú)
            gameState.pieceMoved = true;

            removePossibleMoveHighlights();
            updateBoard(); // Î≥¥Îìú UI Ï†ÑÏ≤¥ ÏóÖÎç∞Ïù¥Ìä∏

            // Ïù¥ÎèôÌïú ÏÖÄÏóê selected ÌÅ¥ÎûòÏä§ Îã§Ïãú Ï†ÅÏö©
            const newCellElement = document.querySelector(`.cell[data-row="${toRow}"][data-col="${toCol}"]`);
            if (newCellElement) {
                 // Ïù¥Ï†Ñ selectedÎäî updateBoard()ÏóêÏÑú ÏßÄÏõåÏßÄÎØÄÎ°ú Îã§Ïãú Ï∂îÍ∞Ä.
                document.querySelectorAll('.cell.selected').forEach(cell => cell.classList.remove('selected'));
                newCellElement.classList.add('selected');
            }
            updateUI(); // ÎÇ®ÏùÄ Î≤Ω Í∞úÏàò Îì± ÏóÖÎç∞Ïù¥Ìä∏
            // ÌÉÄÏù¥Î®∏Îäî Î≤Ω Î∞∞Ïπò ÌõÑ ÎòêÎäî ÌÑ¥ Ï¢ÖÎ£å Ïãú Î¶¨ÏÖã
        }

        // Ïù¥Îèô Í∞ÄÎä•ÏÑ± Í≤ÄÏÇ¨
        function isValidMove(fromRow, fromCol, toRow, toCol) {
            if (toRow < 0 || toRow >= BOARD_SIZE || toCol < 0 || toCol >= BOARD_SIZE) return false; // Î≥¥Îìú Î≤îÏúÑ Î∞ñ
            if (gameState.board[toRow][toCol] !== null) return false; // Î™©Ï†ÅÏßÄÏóê Îã§Î•∏ ÎßêÏù¥ ÏûàÏùå

            const dRow = toRow - fromRow;
            const dCol = toCol - fromCol;
            const absDRow = Math.abs(dRow);
            const absDCol = Math.abs(dCol);

            // 1Ïπ∏ Ïù¥Îèô (ÏÉÅÌïòÏ¢åÏö∞)
            if ((absDRow === 1 && absDCol === 0) || (absDRow === 0 && absDCol === 1)) {
                // Î≤Ω ÌôïÏù∏
                if (dRow === 1) return !gameState.walls[fromRow][fromCol].bottom && !gameState.walls[toRow][toCol].top; // ÏïÑÎûòÎ°ú
                if (dRow === -1) return !gameState.walls[fromRow][fromCol].top && !gameState.walls[toRow][toCol].bottom; // ÏúÑÎ°ú
                if (dCol === 1) return !gameState.walls[fromRow][fromCol].right && !gameState.walls[toRow][toCol].left; // Ïò§Î•∏Ï™ΩÏúºÎ°ú
                if (dCol === -1) return !gameState.walls[fromRow][fromCol].left && !gameState.walls[toRow][toCol].right; // ÏôºÏ™ΩÏúºÎ°ú
                return true; // Ïù¥ Î∂ÄÎ∂ÑÏùÄ ÏÇ¨Ïã§ÏÉÅ ÏúÑ Ï°∞Í±¥Îì§ÏóêÏÑú Îã§ Í±∏Îü¨Ïßê
            }

            // 2Ïπ∏ Ïù¥Îèô (ÏÉÅÌïòÏ¢åÏö∞)
            if ((absDRow === 2 && absDCol === 0) || (absDRow === 0 && absDCol === 2)) {
                const midRow = fromRow + dRow / 2;
                const midCol = fromCol + dCol / 2;

                // Ï§ëÍ∞Ñ Ïπ∏Ïóê Îã§Î•∏ ÎßêÏù¥ ÏóÜÏñ¥Ïïº ÌïòÍ≥†, Î≤ΩÎèÑ ÏóÜÏñ¥Ïïº Ìï®
                if (gameState.board[midRow][midCol] !== null) return false;

                // Ï≤´ Î≤àÏß∏ Ïä§ÌÖù Î≤Ω ÌôïÏù∏
                if (dRow === 2) { // ÏïÑÎûòÎ°ú 2Ïπ∏
                    if (gameState.walls[fromRow][fromCol].bottom || gameState.walls[midRow][midCol].top) return false;
                    if (gameState.walls[midRow][midCol].bottom || gameState.walls[toRow][toCol].top) return false;
                } else if (dRow === -2) { // ÏúÑÎ°ú 2Ïπ∏
                    if (gameState.walls[fromRow][fromCol].top || gameState.walls[midRow][midCol].bottom) return false;
                    if (gameState.walls[midRow][midCol].top || gameState.walls[toRow][toCol].bottom) return false;
                } else if (dCol === 2) { // Ïò§Î•∏Ï™ΩÏúºÎ°ú 2Ïπ∏
                    if (gameState.walls[fromRow][fromCol].right || gameState.walls[midRow][midCol].left) return false;
                    if (gameState.walls[midRow][midCol].right || gameState.walls[toRow][toCol].left) return false;
                } else if (dCol === -2) { // ÏôºÏ™ΩÏúºÎ°ú 2Ïπ∏
                    if (gameState.walls[fromRow][fromCol].left || gameState.walls[midRow][midCol].right) return false;
                    if (gameState.walls[midRow][midCol].left || gameState.walls[toRow][toCol].right) return false;
                }
                return true;
            }
            return false; // Í∑∏ Ïô∏Ïùò Ïù¥ÎèôÏùÄ Î∂àÍ∞Ä
        }
        
        // Î≤Ω Î∂ÄÏàòÍ∏∞ Î™®Îìú ÌÜ†Í∏Ä
        window.toggleWallBreakMode = function() {
            const currentPlayerObj = gameState.players[gameState.currentPlayer];
            if (currentPlayerObj.wallBreakUsed && !gameState.wallBreakMode) { // Ïù¥ÎØ∏ ÏÇ¨Ïö©ÌñàÍ≥†, ÌòÑÏû¨ ÎπÑÌôúÏÑ±Ìôî ÏÉÅÌÉúÎ©¥ Îçî Ïù¥ÏÉÅ Î™ª Ïº¨
                alert('Î≤Ω Î∂ÄÏàòÍ∏∞Îäî Í≤åÏûÑÎãπ 1ÌöåÎßå ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§!');
                return;
            }
             if (gameState.phase < 3) {
                alert('Îßê Î∞∞ÏπòÍ∞Ä ÏôÑÎ£åÎêú ÌõÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.');
                return;
            }
            if (gameState.pieceMoved) {
                alert('ÎßêÏùÑ ÏõÄÏßÅÏù∏ ÌõÑÏóêÎäî Î≤Ω Î∂ÄÏàòÍ∏∞Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§. Îã§Ïùå ÌÑ¥Ïóê ÏãúÎèÑÌïòÏÑ∏Ïöî.');
                return;
            }


            gameState.wallBreakMode = !gameState.wallBreakMode;
            if (gameState.wallBreakMode) {
                gameState.selectedPiece = null; // Îßê ÏÑ†ÌÉù Ìï¥Ï†ú
                document.querySelectorAll('.cell.selected').forEach(cell => cell.classList.remove('selected'));
                removePossibleMoveHighlights();
                alert('Î≤Ω Î∂ÄÏàòÍ∏∞ Î™®Îìú ÌôúÏÑ±Ìôî! Î∂ÄÏà† Î≤ΩÏù¥ ÏûàÎäî Ïπ∏ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
            } else {
                alert('Î≤Ω Î∂ÄÏàòÍ∏∞ Î™®Îìú ÎπÑÌôúÏÑ±Ìôî.');
            }
            updateUI();
        }

        // Î≤Ω Î∂ÄÏàòÍ∏∞ Ï≤òÎ¶¨
        function handleWallBreak(row, col) {
            if (!gameState.wallBreakMode) return;
            
            // TODO: Ïã§Ï†ú Î≤Ω Î∂ÄÏàòÍ∏∞ Î°úÏßÅ Íµ¨ÌòÑ ÌïÑÏöî
            // Ïòà: Ïñ¥Îñ§ Î≤ΩÏùÑ Î∂ÄÏà†ÏßÄ ÏÑ†ÌÉùÌïòÎäî UI (ÏÉÅÌïòÏ¢åÏö∞) ÎòêÎäî ÏûêÎèôÏúºÎ°ú Í∞ÄÏû• ÏµúÍ∑º Î≤Ω Îì±
            // ÌòÑÏû¨Îäî Ïñ¥Îñ§ Î≤ΩÏù¥Îì† ÌïòÎÇòÎùºÎèÑ ÏûàÏúºÎ©¥ Î∂ÄÏâàÎã§Í≥† Í∞ÄÏ†ïÌïòÍ≥† ÌÑ¥ ÎÑòÍπÄ (ÏûÑÏãú)
            let wallBroken = false;
            const cellWalls = gameState.walls[row][col];
            for (const dir in cellWalls) {
                if (cellWalls[dir] !== null) {
                    cellWalls[dir] = null; // Ìï¥Îãπ Î∞©Ìñ• Î≤Ω Ï†úÍ±∞
                    // Ïù∏Ï†ë ÏÖÄÏùò ÎåÄÏùë Î≤ΩÎèÑ Ï†úÍ±∞Ìï¥Ïïº Ìï®
                    if (dir === 'top' && row > 0) gameState.walls[row-1][col].bottom = null;
                    else if (dir === 'bottom' && row < BOARD_SIZE - 1) gameState.walls[row+1][col].top = null;
                    else if (dir === 'left' && col > 0) gameState.walls[row][col-1].right = null;
                    else if (dir === 'right' && col < BOARD_SIZE - 1) gameState.walls[row][col+1].left = null;
                    wallBroken = true;
                    break; 
                }
            }
            // Ïù∏Ï†ë ÏÖÄ Í∏∞Ï§ÄÏúºÎ°úÎèÑ ÌôïÏù∏ (Î≤ΩÏùÄ Îëê ÏÖÄÏóê Í±∏Ï≥ê ÏûàÏúºÎØÄÎ°ú)
            if (!wallBroken && row > 0 && gameState.walls[row-1][col].bottom !== null) { // ÏúÑÏ™Ω ÏÖÄÏùò ÏïÑÎûòÏ™Ω Î≤Ω
                gameState.walls[row-1][col].bottom = null; gameState.walls[row][col].top = null; wallBroken = true;
            } else if (!wallBroken && row < BOARD_SIZE - 1 && gameState.walls[row+1][col].top !== null) { // ÏïÑÎûòÏ™Ω ÏÖÄÏùò ÏúÑÏ™Ω Î≤Ω
                gameState.walls[row+1][col].top = null; gameState.walls[row][col].bottom = null; wallBroken = true;
            } else if (!wallBroken && col > 0 && gameState.walls[row][col-1].right !== null) { // ÏôºÏ™Ω ÏÖÄÏùò Ïò§Î•∏Ï™Ω Î≤Ω
                 gameState.walls[row][col-1].right = null; gameState.walls[row][col].left = null; wallBroken = true;
            } else if (!wallBroken && col < BOARD_SIZE - 1 && gameState.walls[row][col+1].left !== null) { // Ïò§Î•∏Ï™Ω ÏÖÄÏùò ÏôºÏ™Ω Î≤Ω
                 gameState.walls[row][col+1].left = null; gameState.walls[row][col].right = null; wallBroken = true;
            }


            if (wallBroken) {
                alert(`(${row}, ${col}) Í∑ºÏ≤òÏùò Î≤ΩÏùÑ Î∂ÄÏâàÏäµÎãàÎã§!`);
                gameState.players[gameState.currentPlayer].wallBreakUsed = true;
                gameState.wallBreakMode = false; // Î™®Îìú ÏûêÎèô ÎπÑÌôúÏÑ±Ìôî
                updateBoard();
                endTurn(); // Î≤Ω Î∂ÄÏàòÍ∏∞Í∞Ä ÌïòÎÇòÏùò ÌñâÎèôÏúºÎ°ú ÌÑ¥ ÏÜåÎ™®
            } else {
                alert(`(${row}, ${col}) Ï£ºÎ≥ÄÏóê Î∂ÄÏà† Ïàò ÏûàÎäî Î≤ΩÏù¥ ÏóÜÏäµÎãàÎã§.`);
            }
        }

        // ÌÑ¥ Ï¢ÖÎ£å
        function endTurn() {
            console.log("ÌÑ¥ Ï¢ÖÎ£å:", gameState.players[gameState.currentPlayer].name);
            gameState.pieceMoved = false;
            gameState.wallBreakMode = false; // ÌÑ¥ Ï¢ÖÎ£å Ïãú Î≤Ω Î∂ÄÏàòÍ∏∞ Î™®Îìú Ìï¥Ï†ú
            gameState.selectedPiece = null;
            
            document.querySelectorAll('.cell.selected').forEach(cell => cell.classList.remove('selected'));
            removePossibleMoveHighlights();

            gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.playerCount;
            console.log("Îã§Ïùå ÌîåÎ†àÏù¥Ïñ¥:", gameState.players[gameState.currentPlayer].name);
            
            // TODO: Í≤åÏûÑ Ï¢ÖÎ£å Ï°∞Í±¥ ÌôïÏù∏ (Ïòà: Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÏõÄÏßÅÏùº Ïàò ÏóÜÍ±∞ÎÇò, ÌäπÏ†ï Ï†êÏàò ÎèÑÎã¨ Îì±)
            // if (checkGameOver()) {
            //     handleGameOver();
            //     return;
            // }

            updateUI();
            resetTimer();
        }

        // ÌÉÄÏù¥Î®∏ Í¥ÄÎ†® Ìï®ÏàòÎì§
        function startTimer() {
            clearInterval(gameState.timer);
            gameState.timeLeft = INITIAL_TIME_LEFT;
            updateTimerDisplay(); // Ï¶âÏãú ÏãúÍ∞Ñ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                updateTimerDisplay();
                
                if (gameState.timeLeft <= 0) {
                    handleTimeOut();
                }
            }, 1000);
        }

        function resetTimer() {
            // startTimer(); // startTimerÍ∞Ä clearIntervalÏùÑ Ïù¥ÎØ∏ Ìò∏Ï∂úÌï®
            clearInterval(gameState.timer);
            gameState.timeLeft = INITIAL_TIME_LEFT;
            updateTimerDisplay();
            startTimer();
        }

        function updateTimerDisplay() {
            const timerElement = document.getElementById('timer');
            if (!timerElement) return;
            timerElement.textContent = gameState.timeLeft;
            
            timerElement.classList.remove('warning', 'danger');
            if (gameState.timeLeft <= 10) {
                timerElement.classList.add('danger');
            } else if (gameState.timeLeft <= 30) {
                timerElement.classList.add('warning');
            }
        }

        function handleTimeOut() {
            clearInterval(gameState.timer);
            alert(`${gameState.players[gameState.currentPlayer].name} ÌîåÎ†àÏù¥Ïñ¥ ÏãúÍ∞Ñ Ï¥àÍ≥º! Îã§Ïùå ÌîåÎ†àÏù¥Ïñ¥ ÌÑ¥ÏûÖÎãàÎã§.`);
            endTurn();
        }

        // UI ÏóÖÎç∞Ïù¥Ìä∏
        function updateUI() {
            if (!gameState.gameStarted) return; // Í≤åÏûÑ ÏãúÏûë Ï†ÑÏóêÎäî UI ÏóÖÎç∞Ïù¥Ìä∏ Ïïà Ìï®

            const currentPlayerElement = document.getElementById('currentPlayer');
            const wallsRemainingElement = document.getElementById('wallsRemaining');
            const wallBreakBtn = document.getElementById('wallBreakBtn');
            const phaseIndicator = document.getElementById('phaseIndicator');

            if (gameState.phase <= 2) {
                phaseIndicator.textContent = gameState.phase === 1 ? 
                    'Phase 1: Ï≤´ Î≤àÏß∏ Îßê Î∞∞Ïπò' : 'Phase 2: Îëê Î≤àÏß∏ Îßê Î∞∞Ïπò';
            } else {
                phaseIndicator.textContent = 'Phase 3: Í≤åÏûÑ ÌîåÎ†àÏù¥';
            }

            const currentPlayerObj = gameState.players[gameState.currentPlayer];
            currentPlayerElement.textContent = `${currentPlayerObj.name} (${currentPlayerObj.color}) ÌîåÎ†àÏù¥Ïñ¥`;
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏÉâÏÉÅ ÌÅ¥ÎûòÏä§ ÏÑ§Ï†ï
            PLAYER_COLORS.forEach(color => currentPlayerElement.classList.remove(color));
            currentPlayerElement.classList.add(currentPlayerObj.color);

            wallsRemainingElement.textContent = `Î≤Ω ${currentPlayerObj.wallsRemaining}Í∞ú ÎÇ®Ïùå`;

            if (gameState.phase === 3) {
                wallBreakBtn.style.display = 'inline-block';
                wallBreakBtn.disabled = currentPlayerObj.wallBreakUsed || gameState.pieceMoved; // ÏÇ¨Ïö©ÌñàÍ±∞ÎÇò, Îßê Ïù¥Îèô ÌõÑÏóêÎäî ÎπÑÌôúÏÑ±Ìôî
                
                let btnText = 'üî® Î≤Ω Î∂ÄÏàòÍ∏∞ (1Ìöå)';
                if (currentPlayerObj.wallBreakUsed) {
                    btnText = 'üî® Î≤Ω Î∂ÄÏàòÍ∏∞ (ÏÇ¨Ïö©ÏôÑÎ£å)';
                } else if (gameState.wallBreakMode) {
                    btnText = 'üî® Î≤Ω Î∂ÄÏàòÍ∏∞ (ÌôúÏÑ±Ìôî)';
                }
                wallBreakBtn.textContent = btnText;

            } else {
                wallBreakBtn.style.display = 'none';
            }
            updateBlinkingPieces();
        }
        
        // ÍπúÎπ°Ïù¥Îäî Îßê ÏóÖÎç∞Ïù¥Ìä∏
        function updateBlinkingPieces() {
            document.querySelectorAll('.piece.blinking').forEach(p => p.classList.remove('blinking'));

            if (gameState.phase < 3 || !gameState.players[gameState.currentPlayer]) return;

            // ÌòÑÏû¨ ÌÑ¥ ÌîåÎ†àÏù¥Ïñ¥Ïùò ÎßêÎßå ÍπúÎπ°Ïù¥ÎèÑÎ°ù (ÏÑ†ÌÉùÎêòÏßÄ ÏïäÏïòÏùÑ Îïå)
            if (!gameState.selectedPiece && !gameState.pieceMoved) {
                 gameState.players[gameState.currentPlayer].pieces.forEach(piecePos => {
                    if (piecePos.row !== -1) { // Î∞∞ÏπòÎêú ÎßêÎßå
                        const cell = document.querySelector(`.cell[data-row="${piecePos.row}"][data-col="${piecePos.col}"]`);
                        const pieceElement = cell?.querySelector('.piece');
                        if (pieceElement) {
                            pieceElement.classList.add('blinking');
                        }
                    }
                });
            }
        }


        // Î≥¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
        function updateBoard() {
            document.querySelectorAll('.cell').forEach(cellElement => {
                cellElement.innerHTML = ''; // Í∏∞Ï°¥ ÎÇ¥Ïö© Ï¥àÍ∏∞Ìôî (Îßê, Î≤Ω)
                // cellElement.classList.remove('selected'); // ÏÑ†ÌÉù ÌëúÏãúÎäî ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨ÏôÄ Ïù¥Îèô Ìï®ÏàòÏóêÏÑú Í¥ÄÎ¶¨

                const row = parseInt(cellElement.dataset.row);
                const col = parseInt(cellElement.dataset.col);
                
                // Îßê Î†åÎçîÎßÅ
                const pieceData = gameState.board[row][col];
                if (pieceData !== null) {
                    const pieceElement = document.createElement('div');
                    pieceElement.className = `piece ${gameState.players[pieceData.player].color}`;
                    cellElement.appendChild(pieceElement);
                }

                // Î≤Ω Î†åÎçîÎßÅ
                const wallsData = gameState.walls[row][col];
                Object.keys(wallsData).forEach(direction => { // top, bottom, left, right
                    if (wallsData[direction] !== null) { // Î≤Ω Ï£ºÏù∏Ïùò playerIndexÍ∞Ä Ï†ÄÏû•Îê®
                        const wallElement = document.createElement('div');
                        // Î≤ΩÏùò ÏÉâÏÉÅÏùÄ ÏÑ§ÏπòÌïú ÌîåÎ†àÏù¥Ïñ¥Ïùò ÏÉâÏÉÅÏùÑ Îî∞Î•¥ÎèÑÎ°ù
                        wallElement.className = `wall ${direction} ${gameState.players[wallsData[direction]].color}`;
                        cellElement.appendChild(wallElement);
                    }
                });
            });
            updateBlinkingPieces(); // Îßê ÍπúÎπ°ÏûÑ ÏóÖÎç∞Ïù¥Ìä∏
             // ÏÑ†ÌÉùÎêú Îßê ÏûàÏúºÎ©¥ Îã§Ïãú selected ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä (updateBoardÍ∞Ä Îã§ ÏßÄÏö∞ÎØÄÎ°ú)
            if (gameState.selectedPiece) {
                const selectedCell = document.querySelector(`.cell[data-row="${gameState.selectedPiece.row}"][data-col="${gameState.selectedPiece.col}"]`);
                if (selectedCell) selectedCell.classList.add('selected');
            }
        }

        // Í≤åÏûÑ Î¶¨ÏÖã
        window.resetGame = function() {
            clearInterval(gameState.timer);
            gameState.gameStarted = false; // Í≤åÏûÑ Ï¢ÖÎ£å ÏÉÅÌÉúÎ°ú ÏÑ§Ï†ï

            document.getElementById('gameOverModal').style.display = 'none';
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('playerSetup').style.display = 'block';
            
            // ÌîåÎ†àÏù¥Ïñ¥ Ïàò ÏÑ†ÌÉù Î≤ÑÌäº Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.player-count-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
             // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Í∏∞Î≥∏Í∞íÏúºÎ°ú 2Î™Ö ÏÑ†ÌÉùÎêú Í≤ÉÏ≤òÎüº Ï≤òÎ¶¨
            const defaultPlayerCountButton = document.querySelector('.player-count-btn'); // Ï≤´ Î≤àÏß∏ Î≤ÑÌäº (2Î™Ö)
            if (defaultPlayerCountButton) {
                defaultPlayerCountButton.classList.add('selected');
            }
            gameState.playerCount = 2; // gameStateÎèÑ Ï¥àÍ∏∞Ìôî
        }

        // Î≤Ω Î∞∞ÏπòÎ•º ÏúÑÌïú ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        let touchStartPos = null; // {x, y, row, col}

        function addWallPlacementEvents(cell) {
            // ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏
            cell.addEventListener('touchstart', handleTouchStart, {passive: false});
            cell.addEventListener('touchmove', handleTouchMove, {passive: false});
            cell.addEventListener('touchend', handleTouchEnd, {passive: false});
            // ÎßàÏö∞Ïä§ ÎìúÎûòÍ∑∏Î°ú Î≤Ω Î∞∞ÏπòÌïòÎäî Í≤ÉÏùÄ ÌòÑÏû¨ ÎØ∏Íµ¨ÌòÑ. ÌïÑÏöî Ïãú Ï∂îÍ∞Ä.
        }

        function handleTouchStart(e) {
            const cellElement = e.currentTarget;
            const row = parseInt(cellElement.dataset.row);
            const col = parseInt(cellElement.dataset.col);

            // Ï°∞Í±¥: Í≤åÏûÑ ÌîåÎ†àÏù¥ Îã®Í≥Ñ, ÎßêÏù¥ Ïù¥ÎØ∏ Ïù¥ÎèôÌñàÍ≥†, ÌÅ¥Î¶≠Îêú ÏÖÄÏù¥ ÌòÑÏû¨ ÏÑ†ÌÉùÎêú(Ïù¥ÎèôÌïú ÎßêÏù¥ ÏûàÎäî) ÏÖÄÏù¥Ïñ¥Ïïº Ìï®
            if (gameState.phase === 3 && gameState.pieceMoved && 
                gameState.selectedPiece && gameState.selectedPiece.row === row && gameState.selectedPiece.col === col) {
                
                touchStartPos = {
                    x: e.touches[0].clientX,
                    y: e.touches[0].clientY,
                    row: row,
                    col: col
                };
                // e.preventDefault(); // Ïä§ÌÅ¨Î°§ Î∞©ÏßÄ Îì±. ÌïÑÏöîÏóê Îî∞Îùº.
            } else {
                touchStartPos = null;
            }
        }

        function handleTouchMove(e) {
            if (!touchStartPos) return;
            // e.preventDefault(); // Ïä§ÌÅ¨Î°§ Î∞©ÏßÄ Îì±.
        }

        function handleTouchEnd(e) {
            if (!touchStartPos) return;
            // e.preventDefault();

            const touchEndPos = {
                x: e.changedTouches[0].clientX,
                y: e.changedTouches[0].clientY
            };

            const deltaX = touchEndPos.x - touchStartPos.x;
            const deltaY = touchEndPos.y - touchStartPos.y;
            const threshold = 20; // Ïä§ÏôÄÏù¥ÌîÑ Í∞êÏßÄ ÎØºÍ∞êÎèÑ

            let direction = null;
            if (Math.abs(deltaX) > threshold || Math.abs(deltaY) > threshold) {
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    direction = deltaX > 0 ? 'right' : 'left';
                } else {
                    direction = deltaY > 0 ? 'bottom' : 'top';
                }
            }

            if (direction) {
                console.log(`Î≤Ω Î∞∞Ïπò ÏãúÎèÑ: (${touchStartPos.row}, ${touchStartPos.col})Ïóê ${direction} Î∞©Ìñ•ÏúºÎ°ú`);
                placeWallInDirection(touchStartPos.row, touchStartPos.col, direction);
            } else {
                // Ïä§ÏôÄÏù¥ÌîÑÍ∞Ä ÏïÑÎãå Îã®Ïàú ÌÉ≠ÏúºÎ°ú Í∞ÑÏ£ºÎê† Ïàò ÏûàÏùå.
                // Ïù¥ Í≤ΩÏö∞ handleCellClickÏóêÏÑú Ïù¥ÎØ∏ Ï≤òÎ¶¨ÎêòÏóàÍ±∞ÎÇò, Ï∂îÍ∞ÄÏ†ÅÏù∏ Ïï°ÏÖò Ï†ïÏùò Í∞ÄÎä•.
                console.log("Ïä§ÏôÄÏù¥ÌîÑ Í∞êÏßÄ ÏïàÎê®. Îã®Ïàú ÌÉ≠ÏúºÎ°ú Í∞ÑÏ£º.");
            }
            touchStartPos = null;
        }

        // ÌäπÏ†ï Î∞©Ìñ•ÏúºÎ°ú Î≤Ω Î∞∞Ïπò
        function placeWallInDirection(row, col, direction) {
            if (!gameState.pieceMoved) {
                // Ïù¥ Ìï®ÏàòÎäî pieceMoved Ïù¥ÌõÑÏóêÎßå Ìò∏Ï∂úÎêòÎèÑÎ°ù ÏÑ§Í≥ÑÎêòÏñ¥Ïïº Ìï®.
                // alert('Î®ºÏ†Ä ÎßêÏùÑ Ïù¥ÎèôÌï¥Ï£ºÏÑ∏Ïöî!'); // Ïù¥ Í≤ΩÍ≥†Îäî Ìò∏Ï∂úÌïòÎäî Ï™ΩÏóêÏÑú Ï≤òÎ¶¨ÌïòÎäîÍ≤å ÎÇòÏùÑÏàòÎèÑ
                return;
            }

            const currentPlayerObj = gameState.players[gameState.currentPlayer];
            if (currentPlayerObj.wallsRemaining <= 0) {
                alert('Î≤ΩÏù¥ Î™®Îëê ÏÜåÏßÑÎêòÏóàÏäµÎãàÎã§!');
                return;
            }

            // Î≤Ω Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ (Í≤πÏπòÎäîÏßÄ, Ïù∏Ï†ë ÏÖÄÍ≥º Ï∂©ÎèåÌïòÎäîÏßÄ Îì±)
            if (!isValidWallPlacement(row, col, direction)) {
                // isValidWallPlacement ÎÇ¥Î∂ÄÏóêÏÑú alertÏùÑ ÌïòÍ±∞ÎÇò, Ïó¨Í∏∞ÏÑú Ìï¥ÎèÑ Îê®
                return;
            }
            
            // Î≤Ω Î∞∞Ïπò
            gameState.walls[row][col][direction] = gameState.currentPlayer;
            // Ïù∏Ï†ë ÏÖÄÏóêÎèÑ Î≤Ω Ï†ïÎ≥¥ Í∏∞Î°ù (Î≤ΩÏùÄ Îëê ÏÖÄÏóê Í±∏Ï≥ê ÏûàÏùå)
            if (direction === 'top' && row > 0) gameState.walls[row-1][col].bottom = gameState.currentPlayer;
            else if (direction === 'bottom' && row < BOARD_SIZE - 1) gameState.walls[row+1][col].top = gameState.currentPlayer;
            else if (direction === 'left' && col > 0) gameState.walls[row][col-1].right = gameState.currentPlayer;
            else if (direction === 'right' && col < BOARD_SIZE - 1) gameState.walls[row][col+1].left = gameState.currentPlayer;
            
            currentPlayerObj.wallsRemaining--;
            console.log(`${currentPlayerObj.name} ÌîåÎ†àÏù¥Ïñ¥ (${row},${col}) ${direction}Ïóê Î≤Ω ÏÑ§Ïπò. ÎÇ®ÏùÄ Î≤Ω: ${currentPlayerObj.wallsRemaining}`);

            updateBoard(); // Î≥¥Îìú UI ÏóÖÎç∞Ïù¥Ìä∏ (Î≤Ω ÌëúÏãú)
            endTurn(); // Î≤Ω Î∞∞Ïπò ÌõÑ ÌÑ¥ Ï¢ÖÎ£å
        }

        function isValidWallPlacement(row, col, direction) {
            // 1. Ìï¥Îãπ ÏúÑÏπòÏóê Ïù¥ÎØ∏ Í∞ôÏùÄ Î∞©Ìñ• Î≤ΩÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
            if (gameState.walls[row][col][direction] !== null) {
                alert('Ïù¥ÎØ∏ Í∞ôÏùÄ Î∞©Ìñ•Ïóê Î≤ΩÏù¥ ÏûàÏäµÎãàÎã§!');
                return false;
            }

            // 2. ÍµêÏ∞®ÌïòÎäî Î≤Ω ÌôïÏù∏ (Ïòà: Í∞ÄÎ°úÎ≤Ω ÎÜìÎäîÎç∞ ÏÑ∏Î°úÎ≤ΩÏù¥ Ïù¥ÎØ∏ Ìï¥Îãπ ÏÖÄ Î™®ÏÑúÎ¶¨Î•º Í≥µÏú†ÌïòÎ©∞ ÍµêÏ∞®ÌïòÎäîÏßÄ)
            // Quoridor Í∑úÏπôÏóêÏÑúÎäî Î≤ΩÏùÄ Ìï≠ÏÉÅ Îëê Ïπ∏Ïóê Í±∏Ï≥êÏÑú ÏÑ§ÏπòÎêòÎ©∞, Îã§Î•∏ Î≤ΩÍ≥º ÍµêÏ∞®Ìï† Ïàò ÏóÜÏùå.
            // ÌòÑÏû¨ Î≤Ω Î™®Îç∏ÏùÄ ÏÖÄÏùò Í∞Å Î≥ÄÏóê Î≤ΩÏùÑ ÎëêÎäî Î∞©Ïãù.
            // Ï¢Ä Îçî Îã®ÏàúÌôîÎêú Î™®Îç∏ÏóêÏÑúÎäî, Ìïú ÏÖÄÏùò top/bottom Î≤ΩÍ≥º left/right Î≤ΩÏù¥ ÎèôÏãúÏóê ÌôúÏÑ±ÌôîÎêòÎäî Í≤ÉÏùÄ ÍµêÏ∞®Î°ú Í∞ÑÏ£ºÌïòÏßÄ ÏïäÏùÑ Ïàò ÏûàÏùå.
            // Ïó¨Í∏∞ÏÑúÎäî Îçî Î≥µÏû°Ìïú ÍµêÏ∞® Í≤ÄÏÇ¨Îäî ÏÉùÎûµ. (ÌïÑÏöîÏãú Ï∂îÍ∞Ä)

            // 3. Ïù∏Ï†ë ÏÖÄÏóê ÎåÄÏùëÌïòÎäî Î≤ΩÏù¥ Ïù¥ÎØ∏ ÏûàÎäîÏßÄ (Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Ïóê ÏùòÌï¥)
            // (Ïù¥ Í≤ÄÏÇ¨Îäî placeWallInDirectionÏóêÏÑú Ïù¥ÎØ∏ Í∞±Ïã†ÌïòÎØÄÎ°ú ÏÇ¨Ïã§ÏÉÅ Ï§ëÎ≥µÏùº Ïàò ÏûàÏúºÎÇò, Î∞©Ïñ¥Ï†ÅÏúºÎ°ú Ï∂îÍ∞Ä)
            if (direction === 'top' && row > 0 && gameState.walls[row-1][col].bottom !== null) {
                alert('Ïù∏Ï†ëÌïú Í≥≥Ïóê Ïù¥ÎØ∏ Î≤ΩÏù¥ ÏÑ§ÏπòÎêòÏñ¥ ÏûàÏäµÎãàÎã§ (ÏÉÅÎã®).'); return false;
            }
            if (direction === 'bottom' && row < BOARD_SIZE - 1 && gameState.walls[row+1][col].top !== null) {
                alert('Ïù∏Ï†ëÌïú Í≥≥Ïóê Ïù¥ÎØ∏ Î≤ΩÏù¥ ÏÑ§ÏπòÎêòÏñ¥ ÏûàÏäµÎãàÎã§ (ÌïòÎã®).'); return false;
            }
            if (direction === 'left' && col > 0 && gameState.walls[row][col-1].right !== null) {
                alert('Ïù∏Ï†ëÌïú Í≥≥Ïóê Ïù¥ÎØ∏ Î≤ΩÏù¥ ÏÑ§ÏπòÎêòÏñ¥ ÏûàÏäµÎãàÎã§ (Ï¢åÏ∏°).'); return false;
            }
            if (direction === 'right' && col < BOARD_SIZE - 1 && gameState.walls[row][col+1].left !== null) {
                alert('Ïù∏Ï†ëÌïú Í≥≥Ïóê Ïù¥ÎØ∏ Î≤ΩÏù¥ ÏÑ§ÏπòÎêòÏñ¥ ÏûàÏäµÎãàÎã§ (Ïö∞Ï∏°).'); return false;
            }
            
            // 4. (Ï§ëÏöî) Î≤ΩÏùÑ ÎÜìÏïòÏùÑ Îïå Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÏûêÏã†Ïùò Î™©Ìëú ÏßÄÏ†êÏóê ÎèÑÎã¨Ìï† Ïàò ÏóÜÎäî Í≤ΩÏö∞Í∞Ä Î∞úÏÉùÌïòÎäîÏßÄ ÌôïÏù∏ (Quoridor Í∑úÏπô)
            // Ïù¥ Í≤ÄÏÇ¨Îäî BFS/DFS Îì±ÏúºÎ°ú Í≤ΩÎ°ú ÌÉêÏÉâÏù¥ ÌïÑÏöîÌïòÏó¨ Î≥µÏû°ÌïòÎØÄÎ°ú Ïó¨Í∏∞ÏÑúÎäî ÏÉùÎûµ.
            // alert("Í≤ΩÎ°ú Ï∞®Îã® Í≤ÄÏÇ¨Îäî ÎØ∏Íµ¨ÌòÑ ÏÉÅÌÉúÏûÖÎãàÎã§.");

            return true;
        }


        // Í∑úÏπô Î≥¥Í∏∞
        window.showRules = function() {
            alert(`
üß± Wall Go Í≤åÏûÑ Í∑úÏπô (v0.2 - Í∏∞Î≥∏ Í∑úÏπô)

üìã Í≤åÏûÑ Í∞úÏöî:
- 2-${PLAYER_COLORS.length}Î™ÖÏù¥ ${BOARD_SIZE}x${BOARD_SIZE} Í≤©ÏûêÏóêÏÑú Í≤ΩÏüÅÌïòÎäî Ï†ÑÎûµ Í≤åÏûÑ.
- Í∞Å ÌîåÎ†àÏù¥Ïñ¥Îäî 2Í∞úÏùò ÎßêÍ≥º ${INITIAL_WALLS_PER_PLAYER}Í∞úÏùò Î≤ΩÏùÑ Í∞ÄÏßëÎãàÎã§. (Î≤Ω Í∞úÏàòÎäî ÏÑ§Ï†ïÏóê Îî∞Îùº Îã§Î•º Ïàò ÏûàÏùå)

üéØ Í≤åÏûÑ ÏßÑÌñâ:
Phase 1: Ï≤´ Î≤àÏß∏ Îßê Î∞∞Ïπò (ÌîåÎ†àÏù¥Ïñ¥ ÏàúÏÑúÎåÄÎ°ú)
Phase 2: Îëê Î≤àÏß∏ Îßê Î∞∞Ïπò (Phase 1Ïùò Ïó≠ÏàúÏúºÎ°ú)
Phase 3: Í≤åÏûÑ ÌîåÎ†àÏù¥

‚è±Ô∏è ÌÑ¥ Ï†úÌïúÏãúÍ∞Ñ: ${INITIAL_TIME_LEFT}Ï¥à

üö∂ Îßê Ïù¥Îèô:
- ÏûêÏã†Ïùò ÌÑ¥Ïóê ÏûêÏã†Ïùò Îßê Ï§ë ÌïòÎÇòÎ•º ÏÑ†ÌÉùÌïòÏó¨ Ïù¥Îèô.
- ÏÉÅÌïòÏ¢åÏö∞Î°ú 1Ïπ∏ ÎòêÎäî 2Ïπ∏ Ïù¥Îèô Í∞ÄÎä•.
- Îã§Î•∏ ÎßêÏù¥ ÏûàÎäî Í≥≥Ïù¥ÎÇò Î≤ΩÏúºÎ°ú ÎßâÌûå Í≥≥ÏúºÎ°úÎäî Ïù¥Îèô Î∂àÍ∞Ä.
- 2Ïπ∏ Ïù¥Îèô Ïãú, Ï§ëÍ∞Ñ Ïπ∏ÏùÄ ÎπÑÏñ¥ÏûàÏñ¥Ïïº ÌïòÍ≥† Î≤ΩÏúºÎ°ú ÎßâÌòÄÏûàÏßÄ ÏïäÏïÑÏïº Ìï®.

üß± Î≤Ω Î∞∞Ïπò:
- ÎßêÏùÑ Ïù¥ÎèôÌïú ÌõÑ, Ìï¥Îãπ ÌÑ¥Ïóê Î≤Ω 1Í∞úÎ•º ÏÑ§ÏπòÌï† Ïàò ÏûàÏäµÎãàÎã§.
- Î≤ΩÏùÄ Ïù¥ÎèôÌïú ÎßêÏù¥ ÏûàÎäî ÏÖÄÏùò Í∞ÄÏû•ÏûêÎ¶¨(ÏÉÅ, Ìïò, Ï¢å, Ïö∞ Ï§ë ÌïòÎÇò)Ïóê ÏÑ§ÏπòÌï©ÎãàÎã§.
- Î≤ΩÏùÄ ÌÑ∞Ïπò ÌõÑ Ïä§ÏôÄÏù¥ÌîÑÌïòÏó¨ Î∞©Ìñ•ÏùÑ ÏßÄÏ†ïÌï¥ ÏÑ§ÏπòÌï©ÎãàÎã§.
- Ïù¥ÎØ∏ Î≤ΩÏù¥ ÏûàÎäî Í≥≥Ïù¥ÎÇò, Í∑úÏπôÏóê Ïñ¥Í∏ãÎÇòÎäî Í≥≥(Ïòà: Îã§Î•∏ Î≤ΩÍ≥º ÏôÑÏ†ÑÌûà Í≤πÏπ®)ÏóêÎäî ÏÑ§ÏπòÌï† Ïàò ÏóÜÏäµÎãàÎã§.
- (Ï£ºÏùò: Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Ïùò ÎßêÏù¥ Î™©ÌëúÏßÄÏ†êÏóê ÎèÑÎã¨Ìï† Ïàò ÏóÜÎèÑÎ°ù ÏôÑÏ†ÑÌûà Í∞ÄÎëêÎäî Î≤Ω Î∞∞ÏπòÎäî Í∏àÏßÄÎêòÎÇò, ÌòÑÏû¨ Ïù¥ Í≤ÄÏÇ¨ Î°úÏßÅÏùÄ ÎØ∏Íµ¨ÌòÑ ÏÉÅÌÉúÏûÖÎãàÎã§.)

üî® Î≤Ω Î∂ÄÏàòÍ∏∞:
- ÏûêÏã†Ïùò ÌÑ¥ ÏãúÏûë Ïãú, Îßê Ïù¥Îèô Ï†ÑÏóê ÏÇ¨Ïö© Í∞ÄÎä•.
- Í≤åÏûÑÎãπ Îã® 1ÌöåÎßå ÏÇ¨Ïö© Í∞ÄÎä•.
- ÏÇ¨Ïö© Ïãú, Í∏∞Ï°¥Ïóê ÏÑ§ÏπòÎêú Î≤Ω ÌïòÎÇòÎ•º ÏÑ†ÌÉùÌïòÏó¨ Ï†úÍ±∞Ìï©ÎãàÎã§. (ÌòÑÏû¨Îäî ÏÑ†ÌÉùÌïú Ïπ∏ Ï£ºÎ≥ÄÏùò ÏûÑÏùò Î≤Ω Ï†úÍ±∞)
- Î≤Ω Î∂ÄÏàòÍ∏∞Î•º ÏÇ¨Ïö©ÌïòÎ©¥ Ìï¥Îãπ ÌÑ¥Ïùò ÌñâÎèô(Îßê Ïù¥Îèô, Î≤Ω ÏÑ§Ïπò)ÏùÄ Ìï† Ïàò ÏóÜÍ≥† Ï¶âÏãú ÌÑ¥Ïù¥ Ï¢ÖÎ£åÎê©ÎãàÎã§.

üèÜ ÏäπÎ¶¨ Ï°∞Í±¥ (ÎØ∏Íµ¨ÌòÑ):
- (ÏòàÏãú) ÏÉÅÎåÄÎ∞©Ïùò Îëê ÎßêÏùÑ Î™®Îëê ÏûêÏã†Ïùò Î≤ΩÏúºÎ°ú ÏôÑÏ†ÑÌûà Í≥†Î¶ΩÏãúÌÇ§Îäî ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÏäπÎ¶¨.
- (ÏòàÏãú) ÌäπÏ†ï Ï†êÎ†π ÏßÄÏó≠ÏùÑ ÌôïÎ≥¥ÌïòÍ±∞ÎÇò Ï†êÏàòÎ•º ÏñªÎäî Î∞©Ïãù.
- ÌòÑÏû¨ Í≤åÏûÑ Ï¢ÖÎ£å Î∞è ÏäπÎ¶¨ Ï°∞Í±¥ÏùÄ Íµ¨ÌòÑÎêòÏñ¥ ÏûàÏßÄ ÏïäÏäµÎãàÎã§. 'ÏÉà Í≤åÏûÑ'ÏúºÎ°ú Î¶¨ÏÖãÌïòÏó¨ ÌîåÎ†àÏù¥Ìï† Ïàò ÏûàÏäµÎãàÎã§.
            `);
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ï¥àÍ∏∞Ìôî
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å Î∞è Í≤åÏûÑ ÏÑ§Ï†ï Ï§ÄÎπÑ');
            // Í∏∞Î≥∏ÏúºÎ°ú 2Î™Ö ÏÑ†ÌÉùÎêú ÏÉÅÌÉúÎ°ú ÏÑ§Ï†ï
            const defaultPlayerCountButton = document.querySelector('.player-count-btn'); // Ï≤´ Î≤àÏß∏ Î≤ÑÌäº (2Î™Ö)
            if (defaultPlayerCountButton) {
                 // selectPlayerCount(2, {target: defaultPlayerCountButton}); // event Î™®Ïùò Í∞ùÏ≤¥ Ï†ÑÎã¨
                 defaultPlayerCountButton.classList.add('selected'); // ÏßÅÏ†ë ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                 gameState.playerCount = 2; // gameStateÎèÑ Ï¥àÍ∏∞Ìôî
            } else {
                gameState.playerCount = 2; // Î≤ÑÌäº Î™ªÏ∞æÏúºÎ©¥ Í∏∞Î≥∏Í∞í
            }
            // Í≤åÏûÑ ÏãúÏûë Ï†ÑÏù¥ÎØÄÎ°ú gameAreaÏùò UIÎäî ÏïÑÏßÅ ÏóÖÎç∞Ïù¥Ìä∏ÌïòÏßÄ ÏïäÏùå
        });

    })(); // IIFE ÎÅù
    </script>
</body>
</html>
